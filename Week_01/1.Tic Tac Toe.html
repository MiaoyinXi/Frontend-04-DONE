<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic Tac Toe</title>
    <style>
        /*inline-block é»˜è®¤æ˜¯ baseline å¯¹é½ï¼Œçºµå‘å¯¹é½æ–¹å¼æ”¹æˆ middle*/
        /*font-size:50px line-height:100px */
        /*å¦‚æœç”¨ icon-font å’Œ emoji æ¥è¡¨ç¤ºï¼š*/
        /*text-align:center å¸®åŠ©æˆ‘ä»¬æ°´å¹³å±…ä¸­ï¼Œline-height å’Œçˆ¶å…ƒç´ çš„é«˜åº¦ç›¸åŒå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‚ç›´å±…ä¸­*/
        .cell{
            width: 100px;
            height: 100px;
            display: inline-block;
            background-color: burlywood;
            border: solid 1px white;
            vertical-align: middle;

            font-size:50px;
            line-height: 100px;
            text-align: center;
        }
    </style>
</head>
<body>
<div id="board"></div>
<script>
    //ç¬¬ä¸€æ­¥ï¼šç»˜åˆ¶æ£‹ç›˜ show()
    //1.äºŒç»´æ•°ç»„è¡¨ç¤ºæ£‹ç›˜ï¼Œæ¯ä¸ªæ£‹ç›˜æ ¼æœ‰ä¸‰ç§çŠ¶æ€ï¼Œç©º åœˆ å‰
    //2. show() ç»˜åˆ¶æ£‹ç›˜ï¼ŒåŒå±‚ for å¾ªç¯åˆ›å»ºæ£‹ç›˜ï¼Œ
    // Dom API:
    // document.getElementById();
    // document.createElement();
    // dom å®ä¾‹.classList.add()
    // dom å®ä¾‹.innerText()
    // dom å®ä¾‹.appendChild()

    //ç¬¬äºŒæ­¥ï¼šäº‹ä»¶äº¤äº’ move()
    //1.dom å®ä¾‹.addEventListener()ï¼Œè¿™é‡Œæ³¨æ„:let å’Œ var çš„åŒºåˆ«

    //ç¬¬ä¸‰æ­¥ï¼šåˆ¤æ–­è¾“èµ¢ check()

    //ç¬¬å››æ­¥ï¼šAIæ£€æŸ¥æ˜¯ä¸æ˜¯è¦èµ¢

    //ç¬¬äº”æ­¥ï¼šå®Œç¾ AIï¼šç¬¬ä¸€å±‚ç­–ç•¥ï¼šæˆ‘è¦èµ¢ ç¬¬äºŒå±‚ç­–ç•¥ï¼šåˆ«è¾“ ç¬¬ä¸‰å±‚ç­–ç•¥ï¼šâ€¦â€¦ æ£‹è°±

    // æ£‹ç›˜çš„å€¼
    let pattern = [
        0, 0, 0,
        0, 0, 0,
        0, 0, 0
    ];
    // å…¨å±€é»˜è®¤å€¼
    let color = 1;
    // ç»˜åˆ¶æ£‹ç›˜
    function show(){

        let board = document.getElementById('board');
        //æ¸…é™¤æ£‹ç›˜
        board.innerHTML = '';

        for(let i=0;i<3;i++){
            for(let j=0;j<3;j++){
                let cell = document.createElement('div');
                cell.classList.add('cell');
                cell.innerText =
                    pattern[i * 3 + j] === 1
                        ? 'ğŸ·' :
                    pattern[i * 3 + j] === 2
                        ? 'ğŸ¯' :
                        '';
                cell.addEventListener('click',()=>{move(i,j)})
                board.appendChild(cell)
            }
            board.appendChild(document.createElement('br'))
        }
    }
    //å…¨å±€å˜é‡ä» 2-ã€‹1 ä» 1-ã€‹2 ï¼Œä»»ä½•æ»¡è¶³äº¤æ¢å¾‹çš„è¿ç®—éƒ½å¯ä»¥åšåˆ°ï¼Œä¹Ÿå¯ä»¥ç”¨é™¤æ³•ï¼Œ1-ã€‹2ï¼Œ 2-ã€‹1

    //ç”¨æˆ·ä¸‹
    function move(x,y){
        //pattern[y][x]=color//è¿™é‡Œ y å’Œ x çš„ä½ç½®

        pattern[x * 3 + y] = color;
        if (check(pattern, color)) {
            alert(color === 2 ? "ğŸ¯ is winner!" : "ğŸ·ï¸ is winner!");
        }
        color = 3 - color;
        show();
        // if (willWin(pattern, color)) {
        //     console.log(color === 2 ? "ğŸ¯ will win!" : "ğŸ· will win!")
        // }
        // console.log(bestChoice(pattern,color).des);
        computerMove()
    }

    //AI ä¸‹
    function computerMove()  {
        let choice = bestChoice(pattern, color);
        if (choice.point) {
            console.log(choice.point);
            pattern[choice.point[1] * 3 + choice.point[0]] = color
        }
        if (check(pattern, color)) {
            alert(color === 2 ? "ğŸ¯ is winner!" : "ğŸ·ï¸ is winner!");
        }
        color = 3 - color;
        show();
    }

    //æ£€æŸ¥ä¸‰è¡Œä¸‰åˆ—å’Œæ–œè¡Œï¼ˆæ¨ªçºµåæ ‡ç›¸ç­‰ï¼‰ï¼Œå°æŠ€å·§ï¼šä½¿ç”¨ let åšå—çº§ä½œç”¨åŸŸ{}
    //æ£€æµ‹èƒœè´Ÿ
    function check(pattern, color){
        //æ£€æŸ¥æ¨ªè¡Œ
        for (let i = 0; i < 3; i++) {
            let win = true;
            for (let j = 0; j < 3; j++) {
                if (pattern[i * 3 + j] !== color) {
                    win = false;
                }
            }
            if (win) {
                return true;
            }
        }
        //æ£€æŸ¥çºµåˆ—
        for (let i = 0; i < 3; i++) {
            let win = true;
            for (let j = 0; j < 3; j++) {
                if (pattern[j * 3 + i] !== color) {
                    win = false;
                }
            }
            if (win) {
                return true;
            }
        }

        //æ£€æŸ¥å·¦ä¸Šåˆ°å³ä¸‹ï¼ˆæ¨ªçºµåæ ‡éƒ½ç›¸ç­‰ï¼‰
        {
            let win = true
            for (let i = 0; i < 3; i++) {
                if (pattern[i * 3 + i] !== color) {
                    win = false
                }
            }
            if (win) {
                return true
            }
        }
        //æ£€æŸ¥å³ä¸Šåˆ°å·¦ä¸‹
        {
            let win = true
            for (let i = 0; i < 3; i++) {
                if (pattern[i * 3 + 2 - i] !== color) {
                    win = false
                }
            }
            if (win) {
                return true
            }
        }
        return false;
    }
    // function clone(pattern) {
    //     return JSON.parse(JSON.stringify(pattern));
    // }

    //åŸå‹æ–¹æ³•
    function clone(pattern) {
        return Object.create(pattern);
    }
    //ç»“æœé¢„åˆ¤
    function willWin(pattern, color) {
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (pattern[i * 3 + j]) {
                    continue
                }
                let tmp = clone(pattern)
                tmp[i * 3 + j] = color
                if (check(tmp, color)) {
                    return [j, i]
                }
            }
        }
        return null
    }

    //æœ€å¥½çš„ä¸‹æ£‹é€‰æ‹©
    function bestChoice(pattern, color) {
        //çœ‹çœ‹èµ›ç‚¹
        let p = willWin(pattern, color);
        if (p) {
            return {
                point: p,
                result: 1
            }
        }
        //æ‰¾æœ€å·®çš„æƒ…å†µ
        let result =-2;
        let point = null
        outer: for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (pattern[i * 3 + j]) continue;
                let tmp = clone(pattern);
                tmp[i * 3 + j] = color;
                let r = bestChoice(tmp, 3 - color);

                if (-r.result >= result) {
                    result = -r.result;
                    point = [i, j];
                }

                if (result === 1) {
                    break outer;
                }
            }
        }

        return {
            point: point,
            result: point ? result : 0
        }
    }
    show(pattern)
    console.log(bestChoice(pattern,color))

</script>


<!--<script src="test.js"></script>-->
</body>
</html>
